%
%   Chapter Experiment
%
%   Qing-Cheng Li (r01922024 at csie dot ntu dot edu dot tw)
%   R.O.C.103.07
%
\chapter{實驗結果與分析}
\label{c:exp}

本章節進行了以樣式偵測特性的實驗，
以Wikipedia的文章作為模擬內容串流文件、
以YAGO的資料作為答案、
以PATTY提供的樣式對Wikipedia的文章進行偵測。
並介紹評估的標準以及對實驗結果的分析。

\section{測試資料集}
\label{s:dataset}

為了模擬內容串流文件，
本研究以Wikipedia的條目文章作為內容串流中的文件，
自2013年3月的Wikipedia Dumps\footnote{http://dumps.wikimedia.org/}擷取文件。

由於一開始並無文件中包含哪些實體特性的正確資料，
而YAGO的YAGO Facts提供了<subject, property, object>的資訊，
因此我們使用YAGO Facts的propety作為參考答案，
並將subject連結至Wikipedia的文章，
這樣就有每篇文件具有哪些特性的參考答案。

樣式則是使用PATTY提供的樣式釋義，其包含了知識庫定義的關係，
即本研究擬偵測之實體特性，以及可用以表達該特性之樣式集。
實驗採用的是其中的YAGO關係（YAGO Relations），一共有25組關係，
但其中一組關係（YAGO:Produced）在YAGO中沒有找到對映的Wikipedia條目，
因此僅對餘下24組關係進行實驗。

接下來只留下存在這24種特性的Wikipedia條目，
為了防止YAGO Facts中存在某特性但文章中卻根本沒有提及的狀況發生，
我們只留下<subject,property,object>中subject條目內有出現object字詞片段的特性留下，
若object內的字根本沒有出現在文章中，則捨去這個特性。
經過處理後，最後共有334,469篇條目作為測試資料集，
表\ref{t:yago-instance}顯示了各個特性在測試資料集中的數量。

%t:yago-instance
\input{tables/yagoInstance}

表\ref{t:yago-coverage}統計了在不同的信心值下與不同的樣式歧義下，
樣式的數量以及含有這些樣式的文件總數。
由表中可以看出其實當樣式歧義度超過5之後所涵蓋的文件增長速度已經趨於平緩，
因此本實驗最多將只採用歧義度小於等於5的樣式進行。

%t:yago-coverage
\input{tables/yagoCoverage}

由於資料集內的Wikipeida條目皆是描寫實體，
在假設文章的內容都是以描寫該實體的前提下，
可以利用YAGO Simple Types作為該文描述實體之類型，
搭配樣式的領域（Domain）資訊輔助偵測。

而第\ref{c:method}章中所提到需要利用過去的資料進行統計、訓練分類器，
則是將測試資料集分為五等份，以其中四等份作為過去的資料，
並對其進行統計或訓練分類器，
餘下的一份進行測試。

\section{評估標準}
\label{s:eval}
在偵測系統的效率方面，
我們以每顆核心在每分鐘內可以處理多少文件來評估，
以及要達到TREC知識庫加速競賽的每小時處理約100,000篇的規模需要多少運算核心或機器。

在偵測系統的效能方面，
我們希望了解對每一個實體特性，
利用樣式自文章中偵測該特性的效能。
因此，以精確率（Precision）、召回率（Recall）、$F_1$分數（$F_1$ Score）進行評估。
精確率公式如式\ref{f:precision}，召回率公式如式\ref{f:recall}。

\begin{equation}
    \label{f:precision}
    Precision = \frac{|\{relevant\ documents\}\cap\{retrived\ documents\}|}{|\{retrived\ documents\}|}
\end{equation}

\begin{equation}
    \label{f:recall}
    Recall = \frac{|\{relevant\ documents\}\cap\{retrived\ documents\}|}{|\{relevant\ documents\}|}
\end{equation}

對於一個實體特性，經過偵測之後會有被標為有此特性的文件與無此特性的文件。
其中，相關的文件（Relevant documents）即真正存在該特性之文件；
尋回的文件（Retrived documents）即偵測系統標記為擁有此特性之文件。
精確率評估在尋回的文件之中有多少文件真正存在該特性；
召回率評估在真正擁有該特性的文件中有多少被系統偵測到。

$F_1$分數則是綜合評估精確率與召回率，計算方式如式\ref{f:f1}，為精確率與召回率的調和平均。

\begin{equation}
    \label{f:f1}
    F_1\ Score = \frac{2\times Precision \times Recall}{Precision + Recall}
\end{equation}

除了評估個別特性的效能之外，以宏觀平均（Macro Average）及微觀平均（Mirco Average）分別計算精確率與召回率及$F_1$分數來評估整體效能。
以精確率為例，宏觀平均的計算如式\ref{f:macro}，
而微觀平均的計算則如式\ref{f:micro}。

\begin{equation}
    \label{f:macro}
    Macro\ Avg\ Precision=\frac{\sum_i^n precision_i}{n}
\end{equation}

\begin{equation}
    \label{f:micro}
    Mirco\ Avg\ Precision=\frac{\sum_i^n |\{relevant\ documents\}_i|\cap|\{retrived\ documents\}_i|}{\sum_i^n |\{retrived\ documents\}_i|}
\end{equation}

\section{實驗結果}
\label{s:result}

\subsection{效率}
在圖\ref{i:process-v2}的偵測流程之中，本實驗將其拆解為兩個部份來評估效能。
前半部份為樣式比對的效率，後半部份為特性消歧義的效率。

樣式比對的效率在時脈為2.5GHz的中央處理器為每顆核心每分鐘592份文件，
特性消歧義的效率在同樣條件下為每顆核心每分鐘2750份文件。
要在一小時內處理100,000文件僅需要3顆核心即可完成。
而本實驗使用一台配備時脈2.5GHz、24核心中央處理器的工作站僅需半小時即可處理完全部約330,000份文件。

\subsection{原始效能}
依照圖\ref{i:process-v2}的流程，
但於樣式篩選的部分僅篩選了無歧義度以及歧義度小於等於5的樣式，
而無特性消歧義的結果如表\ref{t:baseline-1}。
表中左半部是每一個特性使用無歧義度，也就是歧義度為1的樣式，
進行特性偵測的結果，由於沒有歧義問題，所以無需進行特性消歧義。

右半部則使用了歧義度5及更小的樣式，而不進行特性消歧義，
可以看到的結果是，由於沒有進行特性消歧義而的對每篇文章回答盡可能多的特性，
因此召回率提升，但精確率也因此下降，$F_1$分數則因為精確率降太多而變低。

由此也可以看出太寬鬆地依據樣式回報特性會降低效能，
後續的實驗將陸續加入樣式篩選與特性消歧義的方法， 嘗試改善效能。

%t:baseline-1
\input{tables/baseline-1}

\subsection{樣式篩選}
\subsubsection{信心值}
我們利用PATTY提供的信心值進行樣式的篩選，選定了門檻值分別為0（沒有門檻）、0.7、0.8與0.9，
只使用樣式信心值大於門檻值的樣式進行偵測實驗，其結果的宏觀平均與微觀平均$F_1$分數如圖\ref{i:conf-f1}所示。

\begin{figure}
    \centering
    \includegraphics[width=0.85\textwidth]{images/04-conf-f1}
    \caption{無歧義度下F1分數平均隨信心值變化圖}
    \label{i:conf-f1}
\end{figure}

就整體效能而言，設定信心值門檻值並沒有辦法提升系統效能，反而使效能變差。
這是由於設定門檻值後，通過門檻值的樣式數量減少，導致召回率下降太多，
到門檻值為0.9時，有部分的特性（hasCapital, isKnownFor）已經沒有可用的樣式。
但部分的特性$F_1$分數因精確率比較大幅度的提升而略微上昇，表\ref{}中，
特性%TODO: list those property
的精確率皆有比較大幅度的提升。

% TODO
% build table

\subsubsection{可信賴度}


\subsubsection{歧義度}

\subsection{特性消歧義}
\subsubsection{實體類型資訊}
\subsubsection{正規化？}
\subsubsection{簡單貝氏分類器}
%\subsecion{}
%錯誤分析
